<!DOCTYPE html> 
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ショップマップ（フィルター付き）</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }

    #map {
      width: 100%;
      height: calc(100vh - 190px);
    }

    #filter-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      padding: 10px 14px;
      cursor: pointer;
      font-size: 20px;
      border-radius: 12px; /* ← 丸みのある四角形 */
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      transition: background 0.3s ease;
    }

    #filter-toggle:hover {
      background: #f0f0f0;
    }

    #keyword {
      width: 100%;
      padding: 8px;
      font-size: 15px;
      margin-top: 5px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #clear-filters {
      padding: 8px 16px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      width: 100%;
      margin-top: 12px;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #clear-filters:hover {
      background: #f0f0f0;
    }
    #clear-filters i {
      margin-right: 6px;
      vertical-align: middle;
    }

    /* オートコンプリート候補リスト */
    #autocomplete-list {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 150px;
      overflow-y: auto;
      width: 100%;
      z-index: 1100;
      box-sizing: border-box;
    }

    #autocomplete-list li {
      padding: 6px 10px;
      cursor: pointer;
    }

    #autocomplete-list li:hover {
      background-color: #007bff;
      color: white;
    }

    /* キーワード入力親要素をrelativeに */
    .filter-group.keyword-group {
      position: relative;
    }

    #filter-panel {
      position: absolute;
      top: 60px;
      bottom: 190px; /* ← これが追加ポイント！shop-listと重ならない高さ */
      right: 10px;
      z-index: 999;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px;
      border-radius: 8px;
      width: 90%;
      max-width: 320px;
      /* ↓↓↓ 高さ調整：下のカードと重ならないようにする ↓↓↓ */
      max-height: calc(100vh - 250px); /* 250px = shop-listの高さ */
      overflow-y: auto;  /* 縦スクロールを許可 */

      opacity: 0;
      pointer-events: none;
      transition: max-height 0.3s ease, opacity 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);

      display: block; /* グリッド解除して縦積みに */
      box-sizing: border-box;
    }

    /* フィルターグループは縦積み */
    .filter-group {
      margin-bottom: 16px;
    }

    /* タイトルは縦積みそのまま */
    .filter-group h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
    }

    /* ラベル群は横並びで折り返し */
    .filter-group label {
      display: inline-flex;
      align-items: center;
      margin-right: 12px;
      margin-bottom: 6px;
      white-space: nowrap;
      cursor: pointer;
      user-select: none;
    }

    #shop-list {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      max-height: 170px;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.95);
      z-index: 998;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
    }

    .shop-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      width: 200px;
      box-sizing: border-box;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }

    .shop-card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    #map-container {
      position: relative;
      height: calc(100vh - 190px); /* 下のshop-listを避ける */
    }

    #map {
      width: 100%;
      height: 100%; /* 親要素に合わせる */
    }

    .filter-children {
        margin-left: 20px;
        display: none;
    }

    .filter-parent.open .filter-children {
        display: block;
    }

    .parent-toggle {
    display: flex;
    align-items: flex-start;
    gap: 6px;
    cursor: pointer;
    user-select: none;
    font-weight: 600;
    }

    .toggle-icon {
    /* display: inline-block;
    width: 1em;
    height: 1em;
    transform: rotate(0deg); */
    transition: transform 0.3s ease;
    font-size: 0.9em;
    margin-top: 5px; /* ← 高さ調整 */
    }

    .filter-parent.open .toggle-icon {
    transform: rotate(90deg);
    }

    .toggle-icon::before {
    content: "▶";
    display: inline-block;
    font-size: 0.9em;
    line-height: 1em;
    }

    .parent-label {
    display: flex;
    align-items: center;
    gap: 4px;
    }

    /* モーダル背景 */
    #filter-modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 998;
      display: none;
    }

    /* モーダル本体 */
    #filter-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 92%;
      max-height: 80%;
      background: white;
      border-radius: 12px;
      overflow-y: auto;
      z-index: 999;
      padding: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      display: none;
    }

    #filter-modal.show,
    #filter-modal-overlay.show {
      display: block;
    }

    /* スマホ専用にモーダルを有効化 */
    @media (max-width: 600px) {
      #filter-panel {
        display: none !important;
      }
    }

    @media (max-width: 600px) {
    #filter-panel {
      left: 10px;
      right: 10px;
      width: auto;
      max-width: none;
      height: calc(100vh - 220px); /* 高さを調整してshop-listを避ける */
    }

    #filter-toggle {
      right: 10px;
      top: 10px;
    }

    #shop-list {
      font-size: 13px;
    }

    .shop-card {
      width: calc(100% - 20px); /* モバイルで見やすい幅に */
      max-width: 320px;
      margin: 0 auto;
    }
  }

  </style>
</head>
<body>

<!-- <script>
  let pw;
  do {
    pw = prompt("パスワードを入力してください:");
    if (pw === null) {  // キャンセルしたらページを離れるなど処理を追加
      alert("パスワード入力がキャンセルされました");
      window.location.href = "https://example.com";
      break;
    }
    if (pw !== "abc123") {
      alert("パスワードが違います。もう一度入力してください。");
    }
  } while (pw !== "abc123");
</script> -->


<div id="filter-toggle" title="フィルターを表示">
  <i class="fas fa-sliders-h"></i>
</div>

<div id="map-container">
  <div id="filter-panel">
    <div class="filter-group" id="genre-options">
      <h4>ジャンル</h4>
      <div class="filter-parent">
        <div class="parent-toggle" data-group="izakaya">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="izakaya"> 
                居酒屋
            </label>
        </div>
        <div class="filter-children" data-group="izakaya">
            <label><input type="checkbox" data-category="genre" value="居酒屋"> 居酒屋</label>
            <label><input type="checkbox" data-category="genre" value="立ち飲み"> 立ち飲み</label>
            <label><input type="checkbox" data-category="genre" value="ビアガーデン"> ビアガーデン</label>
            <label><input type="checkbox" data-category="genre" value="ビアホール"> ビアホール</label>
            <label><input type="checkbox" data-category="genre" value="ダイニングバー"> ダイニングバー</label>
            <label><input type="checkbox" data-category="genre" value="バル"> バル</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="bar">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="bar"> 
                バー
            </label>
        </div>
        <div class="filter-children" data-group="bar">
            <label><input type="checkbox" data-category="genre" value="バー"> バー</label>
            <label><input type="checkbox" data-category="genre" value="ビアバー"> ビアバー</label>
            <label><input type="checkbox" data-category="genre" value="ワインバー"> ワインバー</label>
            <label><input type="checkbox" data-category="genre" value="日本酒バー"> 日本酒バー</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="wasyoku">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="wasyoku">
                和食
            </label>
        </div>
        <div class="filter-children" data-group="wasyoku">
            <label><input type="checkbox" data-category="genre" value="焼き鳥"> 焼き鳥</label>
            <label><input type="checkbox" data-category="genre" value="海鮮"> 海鮮</label>
            <label><input type="checkbox" data-category="genre" value="鳥料理"> 鳥料理</label>
            <label><input type="checkbox" data-category="genre" value="串揚げ"> 串揚げ</label> 
            <label><input type="checkbox" data-category="genre" value="沖縄料理"> 沖縄料理</label>      
            <label><input type="checkbox" data-category="genre" value="日本料理"> 日本料理</label>
            <label><input type="checkbox" data-category="genre" value="郷土料理"> 郷土料理</label>
            <label><input type="checkbox" data-category="genre" value="釜飯"> 釜飯</label>
            <label><input type="checkbox" data-category="genre" value="すき焼き"> すき焼き</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="nabe">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="nabe">
                鍋
            </label>
        </div>
        <div class="filter-children" data-group="nabe">
            <label><input type="checkbox" data-category="genre" value="鍋"> 鍋</label>
            <label><input type="checkbox" data-category="genre" value="ちゃんこ鍋"> ちゃんこ鍋</label>      
            <label><input type="checkbox" data-category="genre" value="水炊き"> 水炊き</label>
            <label><input type="checkbox" data-category="genre" value="もつ鍋"> もつ鍋</label>
            <label><input type="checkbox" data-category="genre" value="しゃぶしゃぶ"> しゃぶしゃぶ</label>                   
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="yakiniku">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="yakiniku"> 
                焼肉・ホルモン
            </label>
        </div>
        <div class="filter-children" data-group="yakiniku">
            <label><input type="checkbox" data-category="genre" value="焼肉"> 焼肉</label>
            <label><input type="checkbox" data-category="genre" value="ホルモン"> ホルモン</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="youshoku">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="youshoku">
                洋食・西洋料理
            </label>
        </div>
        <div class="filter-children" data-group="youshoku">
            <label><input type="checkbox" data-category="genre" value="洋食"> 洋食</label>
            <label><input type="checkbox" data-category="genre" value="ステーキ"> ステーキ</label>
            <label><input type="checkbox" data-category="genre" value="ハンバーグ"> ハンバーグ</label>
            <label><input type="checkbox" data-category="genre" value="イタリアン"> イタリアン</label>
            <label><input type="checkbox" data-category="genre" value="スペイン料理"> スペイン料理</label>
            <label><input type="checkbox" data-category="genre" value="ヨーロッパ料理"> ヨーロッパ料理</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="chaina">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="chaina">
                中華料理
            </label>
        </div>
        <div class="filter-children" data-group="chaina">
            <label><input type="checkbox" data-category="genre" value="中華料理"> 中華料理</label>
            <label><input type="checkbox" data-category="genre" value="四川料理"> 四川料理</label>
            <label><input type="checkbox" data-category="genre" value="餃子"> 餃子</label>
            <label><input type="checkbox" data-category="genre" value="飲茶・点心"> 飲茶・点心</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="other">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="other">
                その他レストラン
            </label>
        </div>
        <div class="filter-children" data-group="other">
            <label><input type="checkbox" data-category="genre" value="創作料理"> 創作料理</label> 
            <label><input type="checkbox" data-category="genre" value="BBQ"> BBQ</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="cafe">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="cafe">
                カフェ・喫茶店
            </label>
        </div>
        <div class="filter-children" data-group="cafe">
            <label><input type="checkbox" data-category="genre" value="カフェ"> カフェ</label>      
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="sweet">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="sweet">
                スイーツ
            </label>
        </div>
        <div class="filter-children" data-group="sweet">
          <label><input type="checkbox" data-category="genre" value="ソフトクリーム"> ソフトクリーム</label>
        </div>
      </div>        
    </div>

    <div class="filter-group" id="scene-options">
      <h4>利用シーン</h4>
      <label><input type="checkbox" data-category="scene" value="大人数の宴会"> 大人数の宴会</label>
      <label><input type="checkbox" data-category="scene" value="デート"> デート</label>
      <label><input type="checkbox" data-category="scene" value="知人・友人と"> 知人・友人と</label>
      <label><input type="checkbox" data-category="scene" value="家族・子供と"> 家族・子供と</label>
      <label><input type="checkbox" data-category="scene" value="一人で入りやすい"> 一人で入りやすい</label>
      <label><input type="checkbox" data-category="scene" value="接待"> 接待</label>
      <label><input type="checkbox" data-category="scene" value="女子会"> 女子会</label>
    </div>

    <div class="filter-group" id="seat-options">
      <h4>席・設備</h4>
      <label><input type="checkbox" data-category="seat" value="貸切"> 貸切</label>
      <label><input type="checkbox" data-category="seat" value="個室"> 個室</label>
    </div>

    <div class="filter-group" id="course-options">
      <h4>コース</h4>
      <label><input type="checkbox" data-category="course" value="飲み放題"> 飲み放題</label>
      <label><input type="checkbox" data-category="course" value="食べ放題"> 食べ放題</label>
      <label><input type="checkbox" data-category="course" value="食べ飲み放題"> 食べ飲み放題</label>
    </div>

    <div class="filter-group" id="alcohol-options">
      <h4>こだわり</h4>
      <label><input type="checkbox" data-category="alcohol" value="ザ・パーフェクト黒ラベル"> ザ・パーフェクト黒ラベル</label>
      <label><input type="checkbox" data-category="alcohol" value="神泡"> 神泡</label>
      <label><input type="checkbox" data-category="alcohol" value="エクストラコールド"> エクストラコールド</label>
      <label><input type="checkbox" data-category="alcohol" value="ヱビス"> ヱビス</label>
      <label><input type="checkbox" data-category="alcohol" value="地ビール"> 地ビール</label>
      <label><input type="checkbox" data-category="alcohol" value="地酒"> 地酒</label>
      <label><input type="checkbox" data-category="alcohol" value="日本酒"> 日本酒</label>
      <label><input type="checkbox" data-category="alcohol" value="焼酎"> 焼酎</label>
      <label><input type="checkbox" data-category="alcohol" value="ワイン"> ワイン</label>
      <label><input type="checkbox" data-category="alcohol" value="カクテル"> カクテル</label>
    </div>


    <div class="filter-group keyword-group">
      <h4>キーワード</h4>
      <input type="text" id="keyword" placeholder="店名・住所" autocomplete="off" />
      <ul id="autocomplete-list" style="display:none;"></ul>
    </div>

    <button id="clear-filters"><i class="fas fa-undo"></i>すべて解除</button>
  </div>

  <div id="map"></div>
</div>
<div id="shop-list"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([34.678, 135.160], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let markers = [];

// ---------------------- 店舗データ ----------------------
const shops = [
  {
    "name": "新潟の地酒と銀しゃり 信",
    "address": "大阪府大阪市中央区南本町3-3-23 インペリアル船場ビル B1F",
    "lat": 34.682642,
    "lng": 135.502172,
    "genre": ["居酒屋", "海鮮","日本酒バー"],
    "scene": ["家族・子供と", "一人で入りやすい"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["ザ・パーフェクト黒ラベル", "日本酒"],
    "url": "https://tabelog.com/osaka/A2701/A270106/27090438"
  },
  {
    "name": "とり禅",
    "address": "兵庫県神戸市中央区中山手通1-9-2 MOZANビル 1F",
    "lat": 34.695691,
    "lng": 135.192175,
    "genre": ["焼き鳥", "居酒屋","鳥料理"],
    "scene": ["大人数の宴会", "知人・友人と"],
    "seat": ["個室", "貸切"],
    "course": ["飲み放題"],
    "alcohol": ["焼酎"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28028831"
  },
  {
  "name": "スタンド クラシック",
  "address": "兵庫県神戸市中央区北長狭通1-31-33",
  "lat": 34.692336,
  "lng": 135.19198,
  "genre": ["立ち飲み"],
  "scene": ["一人で入りやすい"],
  "seat": ["なし"],
  "course": ["なし"],
  "alcohol": ["ザ・パーフェクト黒ラベル", "日本酒"], 
  "url": "https://tabelog.com/hyogo/A2801/A280101/28048536/"
  },
  {
    "name": "スターボード",
    "address": "兵庫県神戸市中央区北長狭通2-7-12 pmptビル 2F",
    "lat": 34.692156,
    "lng": 135.189986,
    "genre": ["ビアガーデン", "イタリアン","ダイニングバー"],
    "scene": ["大人数の宴会", "知人・友人と", "一人で入りやすい"],
    "seat": ["なし"],
    "course": ["飲み放題", "食べ飲み放題"],
    "alcohol": ["地ビール"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28026306/"
  },
  {
    "name": "一夜一夜 神戸本店",
    "address": "兵庫県神戸市中央区中山手通1-9-12 Ｍ’Ｓビル １Ｆ",
    "lat": 34.695648,
    "lng": 135.191926,
    "genre": ["居酒屋", "海鮮","日本料理"],
    "scene": ["知人・友人と"],
    "seat": ["なし"],
    "course": ["飲み放題", "食べ放題", "食べ飲み放題"],
    "alcohol": ["日本酒", "地酒"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28000741/"
  },
  {
    "name": "食堂 丸山",
    "address": "兵庫県神戸市中央区下山手通8-15-1 ライオンズマンション神戸元町第三 1F",
    "lat": 34.687122,
    "lng": 135.17963,
    "genre": ["居酒屋"],
    "scene": ["デート"],
    "seat": ["なし"],
    "course": ["飲み放題", "食べ放題", "食べ飲み放題"],
    "alcohol": ["日本酒", "地酒"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28067405/"
  },
  {
    "name": "ピンチョス 元町ヱビス",
    "address": "兵庫県神戸市中央区元町通1-11-13",
    "lat": 34.689827,
    "lng": 135.188831,
    "genre": ["ビアガーデン", "洋食","ヨーロッパ料理"],
    "scene": ["家族・子供と", "知人・友人と", "一人で入りやすい"],
    "seat": ["貸切"],
    "course": ["飲み放題", "食べ放題", "食べ飲み放題"],
    "alcohol": ["ヱビス"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28001953/"
  },
  {
    "name": "エスプリ 三宮6Ｆ店",
    "address": "兵庫県神戸市中央区北長狭通1-2-18 三宮OSビル 6F",
    "lat": 34.694154,
    "lng": 135.193281,
    "genre": ["バー", "居酒屋","バル"],
    "scene": ["大人数の宴会", "知人・友人と", "一人で入りやすい"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["カクテル"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28001618/"
  },
  {
    "name": "明石焼肉 MORISHIN 明石駅前店",
    "address": "兵庫県明石市大明石町1-6-1 パピオス明石 1F",
    "lat": 34.647975,
    "lng": 134.992024,
    "genre": ["焼肉","ホルモン","ダイニングバー"],
    "scene": ["家族・子供と", "デート","知人・友人と"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["神泡"],
    "url": "https://tabelog.com/hyogo/A2804/A280401/28038708/"
  },
  {
    "name": "YAKINIKUEN 忍鬨 東心斎橋2号店",
    "address": "大阪府大阪市中央区東心斎橋1-7-10 アパホテルなんば心斎橋東 1F",
    "lat": 34.672802,
    "lng": 135.505043,
    "genre": ["焼肉"],
    "scene": ["家族・子供と"],
    "seat": ["なし"],
    "course": ["なし"],
    "alcohol": ["神泡"],
    "url": "https://tabelog.com/osaka/A2701/A270201/27128762/"
  },
  {
    "name": "但馬屋イーマ",
    "address": "大阪府大阪市北区梅田1-12-6 イーマ　５Ｆ",
    "lat": 34.700645,
    "lng": 135.498624,
    "genre": ["焼肉","ステーキ","ホルモン"],
    "scene": ["家族・子供と", "接待", "知人・友人と"],
    "seat": ["個室"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒", "ワイン"],
    "url": "https://tabelog.com/osaka/A2701/A270101/27040612/"
  },
  {
    "name": "四川曹家官府菜　蜀",
    "address": "兵庫県神戸市中央区下山手通4-13-5 三木ビル",
    "lat": 34.692594,
    "lng": 135.18581,
    "genre": ["中華料理","四川料理","居酒屋"],
    "scene": ["家族・子供と", "一人で入りやすい", "知人・友人と"],
    "seat": ["個室","貸切"],
    "course": ["なし"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28023301/"
  },
  {
    "name": "すみび焼肉　Da-Wa",
    "address": "大阪府大阪市福島区福島7-8-3 福本ビル 3F",
    "lat": 34.696772,
    "lng": 135.485621,
    "genre": ["焼肉","すき焼き","しゃぶしゃぶ"],
    "scene": ["家族・子供と", "デート"],
    "seat": ["貸切"],
    "course": ["なし"],
    "alcohol": ["ワイン"],
    "url": "https://tabelog.com/osaka/A2701/A270108/27123777/"
  },
  {
    "name": "焼肉一丁 難波店",
    "address": "大阪府大阪市中央区難波3-1-25",
    "lat": 34.665787,
    "lng": 135.502224,
    "genre": ["焼肉","ソフトクリーム"],
    "scene": ["接待", "デート"],
    "seat": ["個室","貸切"],
    "course": ["なし"],
    "alcohol": ["ワイン"],
    "url": "https://tabelog.com/osaka/A2701/A270202/27020008/"
  },
  {
    "name": "酒と肴 SUIGEI",
    "address": "大阪府大阪市北区芝田1-7-2",
    "lat": 34.707354,
    "lng": 135.497981,
    "genre": ["海鮮","居酒屋"],
    "scene": ["なし"],
    "seat": ["なし"],
    "course": ["なし"],
    "alcohol": ["神泡","日本酒"],
    "url": "https://tabelog.com/osaka/A2701/A270101/27108085/"
  },
  {
    "name": "中崎バール Switch",
    "address": "大阪府大阪市北区中崎西1-4-22 梅田東ビル1F",
    "lat": 34.706647,
    "lng": 135.503858,
    "genre": ["イタリアン","バル","スペイン料理"],
    "scene": ["女子会", "知人・友人と"],
    "seat": ["貸切"],
    "course": ["なし"],
    "alcohol": ["神泡","ワイン"],
    "url": "https://tabelog.com/osaka/A2701/A270101/27062704/"
  },
  {
    "name": "くずし割烹　ZUTTO",
    "address": "兵庫県神戸市垂水区平磯4-4-16 川本ビル 1F",
    "lat": 34.628912,
    "lng": 135.055324,
    "genre": ["居酒屋", "海鮮","日本料理"],
    "scene": ["家族・子供と", "接待", "デート"],
    "seat": ["貸切", "個室"],
    "course": ["飲み放題"],
    "alcohol": ["焼酎","日本酒"],
    "url": "https://tabelog.com/hyogo/A2801/A280110/28052878/"
  },
  {
    "name": "はらペコ屋 たま商店",
    "address": "岡山県岡山市北区岩田町2-31",
    "lat": 34.6693,
    "lng": 133.920934,
    "genre": ["居酒屋"],
    "scene": ["接待", "デート"],
    "seat": ["個室"],
    "course": ["飲み放題"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/okayama/A3301/A330101/33018416/"
  },
  {
    "name": "クシヤキとワイン CASSIWA 東通り店",
    "address": "大阪府大阪市北区堂山町6-12 オーパビル 1F",
    "lat": 34.70314,
    "lng": 135.502803,
    "genre": ["居酒屋","焼き鳥","ワインバー"],
    "scene": ["接待", "デート"],
    "seat": ["個室","貸切"],
    "course": ["飲み放題"],
    "alcohol": ["ワイン","カクテル"],
    "url": "https://tabelog.com/osaka/A2701/A270101/27090285/"
  },
  {
    "name": "炭火の王様",
    "address": "兵庫県尼崎市潮江1-16-1 アミング潮江ウエスト",
    "lat": 34.734891,
    "lng": 135.432882,
    "genre": ["居酒屋","ステーキ"],
    "scene": ["なし"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒"],
    "url": "https://tabelog.com/hyogo/A2803/A280304/28063241/"
  },
  {
    "name": "ザ・バージェイダブリューハート",
    "address": "兵庫県神戸市中央区京町25 ORIENTAL HOTEL　１７F",
    "lat": 34.687586,
    "lng": 135.192942,
    "genre": ["バー","イタリアン","カフェ"],
    "scene": ["知人・友人と"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎","ワイン","カクテル"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28024001/"
  },
  {
    "name": "鳥料理 かね正",
    "address": "兵庫県神戸市兵庫区西多聞通2-2-6",
    "lat": 34.678635,
    "lng": 135.172023,
    "genre": ["焼き鳥","鍋","居酒屋"],
    "scene": ["知人・友人と","家族・子供と"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎","ワイン"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28010590/"
  },
  {
    "name": "ラピュタザフランダーステイル 三宮 神戸国際会館前",
    "address": "兵庫県神戸市中央区磯上通7-1-19 プログレス神戸 8F",
    "lat": 34.691986,
    "lng": 135.196852,
    "genre": ["ビアガーデン","ビアホール","BBQ"],
    "scene": ["デート","知人・友人と","家族・子供と","大人数の宴会"],
    "seat": ["貸切"],
    "course": ["飲み放題","食べ放題"],
    "alcohol": ["ザ・パーフェクト黒ラベル"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28028551/"
  },
  {
    "name": "ニューミュンヘン 神戸大使館",
    "address": "兵庫県神戸市中央区三宮町2-5-18",
    "lat": 34.690621,
    "lng": 135.191845,
    "genre": ["ビアバー","洋食","ビアホール"],
    "scene": ["知人・友人と","家族・子供と"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題","食べ放題"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28001655/"
  },
  {
    "name": "Bespoke",
    "address": "兵庫県神戸市中央区北長狭通1-1-3",
    "lat": 34.693448,
    "lng": 135.19343,
    "genre": ["バル","居酒屋","焼き鳥"],
    "scene": ["家族・子供と"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28061943/"
  },
  {
    "name": "炭火焼肉・にくなべ屋 神戸びいどろ 本店",
    "address": "兵庫県神戸市中央区下山手通2-16-2 ITビル1F",
    "lat": 34.693972,
    "lng": 135.189881,
    "genre": ["焼肉","鍋","居酒屋"],
    "scene": ["デート","知人・友人と","家族・子供と","大人数の宴会"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["ワイン","焼酎","カクテル"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28027675/"
  },
  {
    "name": "炭火焼鳥酒場だんご 三宮東店",
    "address": "兵庫県神戸市中央区琴ノ緒町5-2-2 三信ビル 2F",
    "lat": 34.69558,
    "lng": 135.195192,
    "genre": ["焼き鳥","水炊き","居酒屋"],
    "scene": ["知人・友人と"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28043769/"
  },
  {
    "name": "沖縄料理 金魚 三宮本店",
    "address": "兵庫県神戸市中央区北長狭通1-7-5 ハクサンビル　Ｂ１Ｆ～１Ｆ",
    "lat": 34.693479,
    "lng": 135.191901,
    "genre": ["沖縄料理","海鮮","居酒屋"],
    "scene": ["知人・友人と","家族・子供と","大人数の宴会"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題"],
    "alcohol": ["カクテル","神泡"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28003319/"
  },
  {
    "name": "集い居酒屋ふくふく",
    "address": "兵庫県神戸市中央区加納町4-9-29 神戸エステートビル B1F",
    "lat": 34.695694,
    "lng": 135.193262,
    "genre": ["串揚げ","海鮮","居酒屋"],
    "scene": ["知人・友人と","大人数の宴会"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎","神泡"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28003848/"
  },
  {
    "name": "日日是 神戸 段",
    "address": "兵庫県神戸市中央区多聞通3-3-1 神戸アークプラザビル 9F",
    "lat": 34.679945,
    "lng": 135.176777,
    "genre": ["ちゃんこ鍋","海鮮","居酒屋"],
    "scene": ["家族・子供と"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎","神泡","ワイン","カクテル"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28059325/"
  },
  {
    "name": "草乃家",
    "address": "兵庫県神戸市中央区栄町通7-1-10 エクセレンス西元町　１Ｆ",
    "lat": 34.681708,
    "lng": 135.180488,
    "genre": ["創作料理","居酒屋"],
    "scene": ["知人・友人と","家族・子供と","大人数の宴会"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28003662/"
  },
  {
    "name": "汐の風",
    "address": "兵庫県神戸市中央区相生町4-2-5 田中ビル1F",
    "lat": 34.677836,
    "lng": 135.177634,
    "genre": ["居酒屋","海鮮","創作料理"],
    "scene": ["知人・友人と"],
    "seat": ["貸切","個室"],
    "course": ["なし"],
    "alcohol": ["日本酒","焼酎"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28028030/"
  },
  {
    "name": "焼きとり 辻",
    "address": "兵庫県神戸市中央区相生町4-6-7",
    "lat": 34.677631,
    "lng": 135.176407,
    "genre": ["ダイニングバー","鳥料理","焼き鳥"],
    "scene": ["知人・友人と"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28007885/"
  },
  {
    "name": "農業高校レストラン",
    "address": "兵庫県神戸市中央区多聞通1-1-2 太古堂ビル 1F～2F",
    "lat": 34.681902,
    "lng": 135.177985,
    "genre": ["居酒屋"],
    "scene": ["知人・友人と","家族・子供と"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28037545/"
  },
  {
    "name": "黒十 神戸本店",
    "address": "兵庫県神戸市中央区磯上通6-1-9 神戸ＭＫビル　１Ｆ",
    "lat": 34.692082,
    "lng": 135.198229,
    "genre": ["居酒屋","鍋","釜飯"],
    "scene": ["知人・友人と","家族・子供と","接待"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28000085/"
  },
  {
    "name": "銀平 三宮店",
    "address": "兵庫県神戸市中央区加納町4-7-20 イーグルビル　１Ｆ・２Ｆ",
    "lat": 34.696109,
    "lng": 135.192884,
    "genre": ["居酒屋","鳥料理","海鮮"],
    "scene": ["知人・友人と","家族・子供と","接待"],
    "seat": ["個室"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28000732/"
  },
  {
    "name": "郷土料理 からす",
    "address": "兵庫県神戸市中央区加納町4-3-5 シャトー北野坂ビル 1F・B1F",
    "lat": 34.694773,
    "lng": 135.193217,
    "genre": ["居酒屋","郷土料理","海鮮"],
    "scene": ["知人・友人と","家族・子供と","接待","大人数の宴会"],
    "seat": ["個室","貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒","焼酎","カクテル","神泡"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28003669/"
  },
  {
    "name": "満園",
    "address": "兵庫県神戸市中央区北長狭通4-3-23 満園ビル 1F",
    "lat": 34.691181,
    "lng": 135.187785,
    "genre": ["中華料理","餃子","飲茶・点心"],
    "scene": ["家族・子供と"],
    "seat": ["なし"],
    "course": ["なし"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28057759/"
  },
  {
    "name": "からから屋 三宮店",
    "address": "兵庫県神戸市中央区北長狭通1-2-3 二鶴ビル 3F",
    "lat": 34.693957,
    "lng": 135.19308,
    "genre": ["居酒屋","焼肉","もつ鍋"],
    "scene": ["知人・友人と","家族・子供と"],
    "seat": ["貸切"],
    "course": ["なし"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2801/A280101/28002978/"
  },
  {
    "name": "ミート矢澤 名古屋",
    "address": "愛知県名古屋市中村区名駅1-1-3 JRゲートタワー 12F",
    "lat": 35.172172,
    "lng": 136.882529,
    "genre": ["ハンバーグ","ステーキ","洋食"],
    "scene": ["家族・子供と"],
    "seat": ["なし"],
    "course": ["なし"],
    "alcohol": ["神泡"],
    "url": "https://tabelog.com/aichi/A2301/A230101/23063417/"
  },
  {
    "name": "FLEURAGE",
    "address": "大阪府堺市北区百舌鳥梅町3-22-2 ハビテーション中百舌鳥 1F",
    "lat": 34.551759,
    "lng": 135.502139,
    "genre": ["居酒屋","ステーキ","バル"],
    "scene": ["家族・子供と"],
    "seat": ["貸切"],
    "course": ["なし"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/osaka/A2705/A270501/27089856/"
  },
  {
    "name": "鳥名子",
    "address": "京都府福知山市中ノ233-11",
    "lat": 35.300915,
    "lng": 135.121659,
    "genre": ["居酒屋","鳥料理","鍋"],
    "scene": ["知人・友人と"],
    "seat": ["貸切"],
    "course": ["なし"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/kyoto/A2608/A260802/26013202/"
  },
  {
    "name": "懐",
    "address": "兵庫県丹波篠山市二階町58",
    "lat": 35.076885,
    "lng": 135.216825,
    "genre": ["郷土料理","すき焼き","鍋"],
    "scene": ["家族・子供と"],
    "seat": ["貸切","個室"],
    "course": ["なし"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/hyogo/A2807/A280702/28015865/"
  },
  {
    "name": "とろさば料理専門店　SABAR 神戸元町店",
    "address": "兵庫県神戸市中央区元町通3-11-4",
    "lat": 34.687286,
    "lng": 135.184503,
    "genre": ["居酒屋","海鮮","しゃぶしゃぶ"],
    "scene": ["家族・子供と","一人で入りやすい","大人数の宴会"],
    "seat": ["貸切"],
    "course": ["飲み放題"],
    "alcohol": ["日本酒"],
    "url": "https://tabelog.com/hyogo/A2801/A280102/28045233/"
  },
  {
    "name": "肉ト魚 大衆酒場 ひとめぼれ 梅田本店",
    "address": "大阪府大阪市北区曽根崎2-10-14",
    "lat": 34.70068,
    "lng": 135.500585,
    "genre": ["居酒屋","海鮮","鍋"],
    "scene": ["なし"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題","食べ放題"],
    "alcohol": ["なし"],
    "url": "https://tabelog.com/osaka/A2701/A270101/27141273/"
  },
  {
    "name": "海鮮酒場 うおぷく",
    "address": "大阪府大阪市北区堂山町4-12 白馬車BLD. 3F",
    "lat": 34.702542,
    "lng": 135.502122,
    "genre": ["居酒屋","海鮮","日本酒バー"],
    "scene": ["家族・子供と","大人数の宴会"],
    "seat": ["貸切","個室"],
    "course": ["飲み放題","食べ放題"],
    "alcohol": ["日本酒","焼酎","ワイン","カクテル"],
    "url": "https://tabelog.com/osaka/A2701/A270101/27128292/"
  },
];

const selectedFilters = {
  genre: [],
  scene: [],
  seat: [],
  course: [],
  alcohol: [] 
};

const keywordInput = document.getElementById('keyword');
const filterToggle = document.getElementById('filter-toggle');
const filterPanel = document.getElementById('filter-panel');
const clearFiltersBtn = document.getElementById('clear-filters');
const autoCompleteList = document.getElementById('autocomplete-list');

clearFiltersBtn.addEventListener('click', () => {
  document.querySelectorAll('#filter-panel input[type="checkbox"]').forEach(cb => cb.checked = false);
  keywordInput.value = '';
  autoCompleteList.style.display = 'none';
  updateSelectedFiltersAndRefresh();
});

// カスタムアイコンをジャンルごとに設定
const icons = {
  default: L.icon({
    iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
    shadowSize: [41, 41]
  }),
  // 他のジャンル用アイコンがあればここに追加（今回使わない）
};

filterToggle.addEventListener('click', () => {
  const isMobile = window.innerWidth <= 600;
  if (isMobile) {
    document.getElementById("filter-modal").classList.add("show");
    document.getElementById("filter-modal-overlay").classList.add("show");
  } else {
    if (filterPanel.style.maxHeight && filterPanel.style.maxHeight !== '0px') {
      filterPanel.style.maxHeight = '0';
      filterPanel.style.opacity = '0';
      filterPanel.style.pointerEvents = 'none';
    } else {
      filterPanel.style.maxHeight = filterPanel.scrollHeight + 'px';
      filterPanel.style.opacity = '1';
      filterPanel.style.pointerEvents = 'auto';
    }
  }
});

document.querySelectorAll('#filter-panel input[type="checkbox"], #filter-modal input[type="checkbox"]').forEach(checkbox => {
  checkbox.addEventListener('change', updateSelectedFiltersAndRefresh);
});


keywordInput.addEventListener('input', () => {
  const val = keywordInput.value.trim().toLowerCase();
  if (val.length === 0) {
    autoCompleteList.style.display = 'none';
    updateMarkers();
    return;
  }
  const matches = shops.filter(shop =>
    shop.name.toLowerCase().includes(val) || shop.address.toLowerCase().includes(val)
  ).slice(0, 10);

  autoCompleteList.innerHTML = '';
  if (matches.length === 0) {
    autoCompleteList.style.display = 'none';
    updateMarkers();
    return;
  }
  matches.forEach(shop => {
    const li = document.createElement('li');
    li.textContent = shop.name + ' - ' + shop.address;
    li.addEventListener('mousedown', () => {
      keywordInput.value = shop.name;
      autoCompleteList.style.display = 'none';
      updateMarkers();
    });
    autoCompleteList.appendChild(li);
  });
  autoCompleteList.style.display = 'block';
});

document.addEventListener('click', e => {
  if (!keywordInput.contains(e.target) && !autoCompleteList.contains(e.target)) {
    autoCompleteList.style.display = 'none';
  }
});

keywordInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    autoCompleteList.style.display = 'none';
    updateMarkers();
  }
});

clearFiltersBtn.addEventListener('click', () => {
  document.querySelectorAll('#filter-panel input[type="checkbox"]').forEach(cb => cb.checked = false);
  selectedFilters.genre = [];
  selectedFilters.scene = [];
  selectedFilters.seat = [];
  selectedFilters.course = [];
  selectedFilters.alcohol = [];
  keywordInput.value = '';
  autoCompleteList.style.display = 'none';
  updateMarkers();
});

updateMarkers();

// 親チェックボックスですべてON/OFF
// ▼▼▼ 親項目クリックで折りたたみ＋一括選択 ▼▼▼
document.querySelectorAll('.parent-toggle').forEach(toggle => {
  const group = toggle.dataset.group;
  const parent = toggle.closest('.filter-parent');

  toggle.addEventListener('click', (e) => {
    parent.classList.toggle('open');
  });

  // 親チェックで子も一括選択
  const parentCheckbox = toggle.querySelector('input.parent-checkbox');
  parentCheckbox.addEventListener('change', () => {
    const children = document.querySelectorAll(`.filter-children[data-group="${group}"] input[type="checkbox"]`);
    children.forEach(child => child.checked = parentCheckbox.checked);

    // ✅ 正しくチェック状態を反映させる
    updateSelectedFiltersAndRefresh();
  });
});


function normalizeArrayField(field) {
  if (!field) return [];
  return Array.isArray(field) ? field : [field];
}

function updateMarkers() {
  const shopListDiv = document.getElementById('shop-list');
  shopListDiv.innerHTML = ''; // 検索結果リストをリセット

  const keyword = keywordInput.value.trim().toLowerCase();

  markers.forEach(marker => map.removeLayer(marker));
  markers = [];
  
  const sortedShops = [...shops].sort((a, b) => a.name.localeCompare(b.name, 'ja'));

  sortedShops.forEach(shop => {
    const shopGenre = normalizeArrayField(shop.genre);
    const shopScene = normalizeArrayField(shop.scene);
    const shopSeat = normalizeArrayField(shop.seat);
    const shopCourse = normalizeArrayField(shop.course);
    const shopAlcohol = normalizeArrayField(shop.alcohol);

    const matchesGenre = selectedFilters.genre.length === 0 || selectedFilters.genre.some(f => shopGenre.includes(f));
    const matchesscene = selectedFilters.scene.length === 0 || selectedFilters.scene.some(f => shopScene.includes(f));
    const matchesseat = selectedFilters.seat.length === 0 || selectedFilters.seat.some(f => shopSeat.includes(f));
    const matchescourse = selectedFilters.course.length === 0 || selectedFilters.course.some(f => shopCourse.includes(f));
    const matchesAlcohol = selectedFilters.alcohol.length === 0 || selectedFilters.alcohol.some(f => shopAlcohol.includes(f));

    const matchesKeyword =
      keyword === '' ||
      shop.name.toLowerCase().includes(keyword) ||
      shop.address.toLowerCase().includes(keyword);

    if (matchesGenre && matchesscene && matchesseat && matchescourse && matchesAlcohol && matchesKeyword) {
      const popupContent = `
        <div style="text-align:center; max-width: 200px;">
          <strong>${shop.name}</strong><br>
          ${shop.address}<br>
          <a href="${shop.url}" target="_blank" style="color: blue;">
            お店のページを見る
          </a>
        </div>
      `;
      const icon = icons["default"];
      const marker = L.marker([shop.lat, shop.lng], { icon })
        .addTo(map)
        .bindPopup(popupContent);
      markers.push(marker);

      // カード作成
      const card = document.createElement('div');
      card.className = 'shop-card';
      card.innerHTML = `
        <strong>${shop.name}</strong><br>
        <span style="font-size:13px;">${shop.address}</span><br>
        <a href="${shop.url}" target="_blank">詳細を見る</a>
      `;
      card.addEventListener('click', () => {
        map.setView([shop.lat, shop.lng], 17);
        marker.openPopup();
      });

      shopListDiv.appendChild(card);

    }
  });
}

function updateSelectedFiltersAndRefresh() {
  const allCheckboxes = document.querySelectorAll('input[data-category]');

  selectedFilters.genre = Array.from(allCheckboxes)
    .filter(cb => cb.dataset.category === 'genre' && cb.checked)
    .map(cb => cb.value);

  selectedFilters.scene = Array.from(allCheckboxes)
    .filter(cb => cb.dataset.category === 'scene' && cb.checked)
    .map(cb => cb.value);

  selectedFilters.seat = Array.from(allCheckboxes)
    .filter(cb => cb.dataset.category === 'seat' && cb.checked)
    .map(cb => cb.value);

  selectedFilters.course = Array.from(allCheckboxes)
    .filter(cb => cb.dataset.category === 'course' && cb.checked)
    .map(cb => cb.value);

  selectedFilters.alcohol = Array.from(allCheckboxes)
    .filter(cb => cb.dataset.category === 'alcohol' && cb.checked)
    .map(cb => cb.value);

  updateMarkers();
}


document.getElementById("filter-modal-overlay").addEventListener("click", () => {
  document.getElementById("filter-modal").classList.remove("show");
  document.getElementById("filter-modal-overlay").classList.remove("show");
});

document.getElementById('clear-filters-mobile')?.addEventListener('click', () => {
  document.querySelectorAll('#filter-modal input[type="checkbox"]').forEach(cb => cb.checked = false);
  selectedFilters.genre = [];
  selectedFilters.scene = [];
  selectedFilters.seat = [];
  selectedFilters.course = [];
  selectedFilters.alcohol = [];
  keywordInput.value = '';
  autoCompleteList.style.display = 'none';
  updateSelectedFiltersAndRefresh();
  closeModal(); // ← 追加で閉じる
});

document.querySelectorAll('.filter-children input[type="checkbox"]').forEach(cb => {
  cb.addEventListener('change', () => {
    updateSelectedFiltersAndRefresh();
  });
});

// 検索ボタンクリック時にも実行される
document.getElementById('search-button').addEventListener('click', () => {
  updateSelectedFiltersAndRefresh();
  closeModal();
});


function closeModal() {
  document.getElementById("filter-modal").classList.remove("show");
  document.getElementById("filter-modal-overlay").classList.remove("show");
}


</script>

<!-- モーダルの背景 -->
<div id="filter-modal-overlay"></div>

<!-- モーダル本体（スマホ用） -->
<div id="filter-modal">
  <div id="filter-modal-content">

    <div class="filter-group" id="genre-options">
      <h4>ジャンル</h4>
      <div class="filter-parent">
        <div class="parent-toggle" data-group="izakaya">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="izakaya"> 
                居酒屋
            </label>
        </div>
        <div class="filter-children" data-group="izakaya">
            <label><input type="checkbox" data-category="genre" value="居酒屋"> 居酒屋</label>
            <label><input type="checkbox" data-category="genre" value="立ち飲み"> 立ち飲み</label>
            <label><input type="checkbox" data-category="genre" value="ビアガーデン"> ビアガーデン</label>
            <label><input type="checkbox" data-category="genre" value="ビアホール"> ビアホール</label>
            <label><input type="checkbox" data-category="genre" value="ダイニングバー"> ダイニングバー</label>
            <label><input type="checkbox" data-category="genre" value="バル"> バル</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="bar">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="bar"> 
                バー
            </label>
        </div>
        <div class="filter-children" data-group="bar">
            <label><input type="checkbox" data-category="genre" value="バー"> バー</label>
            <label><input type="checkbox" data-category="genre" value="ビアバー"> ビアバー</label>
            <label><input type="checkbox" data-category="genre" value="ワインバー"> ワインバー</label>
            <label><input type="checkbox" data-category="genre" value="日本酒バー"> 日本酒バー</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="wasyoku">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="wasyoku">
                和食
            </label>
        </div>
        <div class="filter-children" data-group="wasyoku">
            <label><input type="checkbox" data-category="genre" value="焼き鳥"> 焼き鳥</label>
            <label><input type="checkbox" data-category="genre" value="海鮮"> 海鮮</label>
            <label><input type="checkbox" data-category="genre" value="鳥料理"> 鳥料理</label>
            <label><input type="checkbox" data-category="genre" value="串揚げ"> 串揚げ</label> 
            <label><input type="checkbox" data-category="genre" value="沖縄料理"> 沖縄料理</label>      
            <label><input type="checkbox" data-category="genre" value="日本料理"> 日本料理</label>
            <label><input type="checkbox" data-category="genre" value="郷土料理"> 郷土料理</label>
            <label><input type="checkbox" data-category="genre" value="釜飯"> 釜飯</label>
            <label><input type="checkbox" data-category="genre" value="すき焼き"> すき焼き</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="nabe">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="nabe">
                鍋
            </label>
        </div>
        <div class="filter-children" data-group="nabe">
            <label><input type="checkbox" data-category="genre" value="鍋"> 鍋</label>
            <label><input type="checkbox" data-category="genre" value="ちゃんこ鍋"> ちゃんこ鍋</label>      
            <label><input type="checkbox" data-category="genre" value="水炊き"> 水炊き</label>
            <label><input type="checkbox" data-category="genre" value="もつ鍋"> もつ鍋</label>
            <label><input type="checkbox" data-category="genre" value="しゃぶしゃぶ"> しゃぶしゃぶ</label>                   
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="yakiniku">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="yakiniku"> 
                焼肉・ホルモン
            </label>
        </div>
        <div class="filter-children" data-group="yakiniku">
            <label><input type="checkbox" data-category="genre" value="焼肉"> 焼肉</label>
            <label><input type="checkbox" data-category="genre" value="ホルモン"> ホルモン</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="youshoku">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="youshoku">
                洋食・西洋料理
            </label>
        </div>
        <div class="filter-children" data-group="youshoku">
            <label><input type="checkbox" data-category="genre" value="洋食"> 洋食</label>
            <label><input type="checkbox" data-category="genre" value="ステーキ"> ステーキ</label>
            <label><input type="checkbox" data-category="genre" value="ハンバーグ"> ハンバーグ</label>
            <label><input type="checkbox" data-category="genre" value="イタリアン"> イタリアン</label>
            <label><input type="checkbox" data-category="genre" value="スペイン料理"> スペイン料理</label>
            <label><input type="checkbox" data-category="genre" value="ヨーロッパ料理"> ヨーロッパ料理</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="chaina">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="chaina">
                中華料理
            </label>
        </div>
        <div class="filter-children" data-group="chaina">
            <label><input type="checkbox" data-category="genre" value="中華料理"> 中華料理</label>
            <label><input type="checkbox" data-category="genre" value="四川料理"> 四川料理</label>
            <label><input type="checkbox" data-category="genre" value="餃子"> 餃子</label>
            <label><input type="checkbox" data-category="genre" value="飲茶・点心"> 飲茶・点心</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="other">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="other">
                その他レストラン
            </label>
        </div>
        <div class="filter-children" data-group="other">
            <label><input type="checkbox" data-category="genre" value="創作料理"> 創作料理</label> 
            <label><input type="checkbox" data-category="genre" value="BBQ"> BBQ</label>
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="cafe">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="cafe">
                カフェ・喫茶店
            </label>
        </div>
        <div class="filter-children" data-group="cafe">
            <label><input type="checkbox" data-category="genre" value="カフェ"> カフェ</label>      
        </div>
      </div>

      <div class="filter-parent">
        <div class="parent-toggle" data-group="sweet">
            <i class="fas fa-chevron-right toggle-icon"></i>
            <label class="parent-label">
                <input type="checkbox" class="parent-checkbox" data-group="sweet">
                スイーツ
            </label>
        </div>
        <div class="filter-children" data-group="sweet">
          <label><input type="checkbox" data-category="genre" value="ソフトクリーム"> ソフトクリーム</label>
        </div>
      </div>        
    </div>

    <div class="filter-group" id="scene-options">
      <h4>利用シーン</h4>
      <label><input type="checkbox" data-category="scene" value="大人数の宴会"> 大人数の宴会</label>
      <label><input type="checkbox" data-category="scene" value="デート"> デート</label>
      <label><input type="checkbox" data-category="scene" value="知人・友人と"> 知人・友人と</label>
      <label><input type="checkbox" data-category="scene" value="家族・子供と"> 家族・子供と</label>
      <label><input type="checkbox" data-category="scene" value="一人で入りやすい"> 一人で入りやすい</label>
      <label><input type="checkbox" data-category="scene" value="接待"> 接待</label>
      <label><input type="checkbox" data-category="scene" value="女子会"> 女子会</label>
    </div>

    <div class="filter-group" id="seat-options">
      <h4>席・設備</h4>
      <label><input type="checkbox" data-category="seat" value="貸切"> 貸切</label>
      <label><input type="checkbox" data-category="seat" value="個室"> 個室</label>
    </div>

    <div class="filter-group" id="course-options">
      <h4>コース</h4>
      <label><input type="checkbox" data-category="course" value="飲み放題"> 飲み放題</label>
      <label><input type="checkbox" data-category="course" value="食べ放題"> 食べ放題</label>
      <label><input type="checkbox" data-category="course" value="食べ飲み放題"> 食べ飲み放題</label>
    </div>

    <div class="filter-group" id="alcohol-options">
      <h4>こだわり</h4>
      <label><input type="checkbox" data-category="alcohol" value="ザ・パーフェクト黒ラベル"> ザ・パーフェクト黒ラベル</label>
      <label><input type="checkbox" data-category="alcohol" value="神泡"> 神泡</label>
      <label><input type="checkbox" data-category="alcohol" value="エクストラコールド"> エクストラコールド</label>
      <label><input type="checkbox" data-category="alcohol" value="ヱビス"> ヱビス</label>
      <label><input type="checkbox" data-category="alcohol" value="地ビール"> 地ビール</label>
      <label><input type="checkbox" data-category="alcohol" value="地酒"> 地酒</label>
      <label><input type="checkbox" data-category="alcohol" value="日本酒"> 日本酒</label>
      <label><input type="checkbox" data-category="alcohol" value="焼酎"> 焼酎</label>
      <label><input type="checkbox" data-category="alcohol" value="ワイン"> ワイン</label>
      <label><input type="checkbox" data-category="alcohol" value="カクテル"> カクテル</label>
    </div>


    <div class="filter-group keyword-group">
      <h4>キーワード</h4>
      <input type="text" id="keyword" placeholder="店名・住所" autocomplete="off" />
      <ul id="autocomplete-list" style="display:none;"></ul>
    </div>

    <button id="clear-filters-mobile"><i class="fas fa-undo"></i>すべて解除</button>
    
    <!-- モバイルのfilter-modalの中、すべて解除のあとなどに追記 -->
    <button id="search-button" style="margin-top: 16px;">検索</button>

    <button id="clear-filters-mobile" style="
      padding: 8px 16px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      width: 100%;
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    ">
      <i class="fas fa-undo" style="margin-right: 6px;"></i>すべて解除
    </button>

  </div>
</div>

</body>
</html>